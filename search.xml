<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Docker下Redis配置</title>
      <link href="/2023/09/06/Docker%E4%B8%8BRedis%E9%85%8D%E7%BD%AE/"/>
      <url>/2023/09/06/Docker%E4%B8%8BRedis%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<blockquote><p>由于电脑系统重装，本地环境需要重新搭载，网上各种教程让人眼花缭乱，所以打算自己记录下本次搭建环境的过程，方便以后环境的快速搭载。</p><p>搭载环境：centos7 + docker</p></blockquote><h1 id="1-Docker下载安装"><a href="#1-Docker下载安装" class="headerlink" title="1.Docker下载安装"></a>1.Docker下载安装</h1><h2 id="1-1卸载"><a href="#1-1卸载" class="headerlink" title="1.1卸载"></a>1.1卸载</h2><p>如果之前安装过Docker，可使用以下命令进行卸载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine \</span><br><span class="line">                  docker-ce</span><br></pre></td></tr></table></figure><h2 id="1-2安装Docker"><a href="#1-2安装Docker" class="headerlink" title="1.2安装Docker"></a>1.2安装Docker</h2><p>首先安装yum工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2 --skip-broken</span><br></pre></td></tr></table></figure><p>更新本地镜像源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置Docker的镜像源，这里采用阿里的</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">sed -i <span class="string">&#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><p>安装社区版Docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce</span><br></pre></td></tr></table></figure><h2 id="1-3启动Docker"><a href="#1-3启动Docker" class="headerlink" title="1.3启动Docker"></a>1.3启动Docker</h2><p>关闭系统防火墙</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld  </span><br></pre></td></tr></table></figure><p>通过命令启动docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动docker服务</span></span><br><span class="line">systemctl start docker </span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止docker服务</span></span><br><span class="line">systemctl stop docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启docker服务</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><p>查看本地Docker版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure><h1 id="2-Docker下Redis下载配置"><a href="#2-Docker下Redis下载配置" class="headerlink" title="2.Docker下Redis下载配置"></a>2.Docker下Redis下载配置</h1><h2 id="2-1获取redis镜像"><a href="#2-1获取redis镜像" class="headerlink" title="2.1获取redis镜像"></a>2.1获取redis镜像</h2><p><a href="https://hub.docker.com/_/redis?tab=tags">Docker的镜像仓库</a></p><h2 id="2-2下载redis镜像"><a href="#2-2下载redis镜像" class="headerlink" title="2.2下载redis镜像"></a>2.2下载redis镜像</h2><p>下载redis镜像文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis <span class="comment">#拉取最新版的redis</span></span><br><span class="line">docker pull redis:xxx <span class="comment">#下载指定版本的redis（xxx为版本号）</span></span><br></pre></td></tr></table></figure><p>查看docker中的镜像文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看镜像文件</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker images               </span></span><br><span class="line">REPOSITORY             TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">redis                  latest    506734eb5e71   2 weeks ago   138MB</span><br></pre></td></tr></table></figure><h2 id="2-3创建Redis配置挂载文件"><a href="#2-3创建Redis配置挂载文件" class="headerlink" title="2.3创建Redis配置挂载文件"></a>2.3创建Redis配置挂载文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /home/redis/conf  </span><br><span class="line"><span class="comment">#创建配置文件</span></span><br><span class="line"><span class="built_in">touch</span> /home/redis/conf/redis.conf</span><br></pre></td></tr></table></figure><p>需要将<a href="https://gitee.com/crushlxb/myredis/blob/master/redis.conf#">配置文件内容</a>保存到redis.conf中</p><p>修改配置文件设置密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># requirepass foobared</span></span><br><span class="line">requirepass  123456    <span class="comment">#设置成你自己的密码，我这里就设置成123456</span></span><br></pre></td></tr></table></figure><p>修改配置文件(127.0.0.1是仅允许本机访问)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bind 127.0.0.1</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br></pre></td></tr></table></figure><h2 id="2-4指定配置文件启动redis容器"><a href="#2-4指定配置文件启动redis容器" class="headerlink" title="2.4指定配置文件启动redis容器"></a>2.4指定配置文件启动redis容器</h2><p>执行命令创建redis容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 --name redis \</span><br><span class="line">-v /home/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-v /home/redis/conf/data:/data \</span><br><span class="line">-d redis redis-server /etc/redis/redis.conf --appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">命令</th><th>描述</th></tr></thead><tbody><tr><td align="left">–name redis</td><td>设置容器的名字</td></tr><tr><td align="left">-p 6379:6379</td><td>将容器的 6379端口映射到主机的 6379端口</td></tr><tr><td align="left">–restart unless-stopped</td><td>容器重启策略（具体看你怎么配置，我这里没配用的默认的）</td></tr><tr><td align="left">-v &#x2F;home&#x2F;redis&#x2F;data:&#x2F;data</td><td>将Redis储存文件夹挂在到主机</td></tr><tr><td align="left">-v &#x2F;home&#x2F;redis&#x2F;conf&#x2F;redis.conf:&#x2F;etc&#x2F;redis&#x2F;redis.conf</td><td>将配置文件夹挂在到主机</td></tr><tr><td align="left">redis-server &#x2F;etc&#x2F;redis&#x2F;redis.conf</td><td>Redis 容器中设置 redis-server 每次启动读取 &#x2F;etc&#x2F;redis&#x2F;redis.conf 这个配置为准</td></tr><tr><td align="left">–appendonly yes</td><td>在Redis容器启动redis-server服务器并打开Redis持久化配置</td></tr><tr><td align="left">\</td><td>shell 命令换行</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># docker start redis</span></span><br><span class="line">redis</span><br><span class="line"><span class="comment">#查看docker中运行的容器</span></span><br><span class="line">[root@localhost conf]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                   CREATED         STATUS         PORTS                                       NAMES</span><br><span class="line">c9ee93a5114b   redis     <span class="string">&quot;docker-entrypoint.s…&quot;</span>   4 minutes ago   Up 3 seconds   0.0.0.0:6379-&gt;6379/tcp, :::6379-&gt;6379/tcp   redis</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果redis没有正常启动则执行下面命令查询日志</span></span><br><span class="line">docker logs redis</span><br></pre></td></tr></table></figure><h2 id="2-5进入redis容器"><a href="#2-5进入redis容器" class="headerlink" title="2.5进入redis容器"></a>2.5进入redis容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost conf]<span class="comment"># docker exec -it redis bash</span></span><br><span class="line">root@c9ee93a5114b:/data<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name cxy</span><br><span class="line">(error) NOAUTH Authentication required.     <span class="comment">#报错是因为要输入密码</span></span><br><span class="line">127.0.0.1:6379&gt; auth 123456                 <span class="comment">#输入密码123456</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name cxy</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name </span><br><span class="line"><span class="string">&quot;cxy&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Test</title>
      <link href="/2023/09/05/HelloWorld/"/>
      <url>/2023/09/05/HelloWorld/</url>
      
        <content type="html"><![CDATA[<h1 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello world"></a>Hello world</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 标签1 </tag>
            
            <tag> 标签2 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
